<style scoped>
	ul {
		list-style-type: none;
		padding-left: 4rem;
	}
	table {
		border-collapse:collapse;		
	}
	td {
		padding:.25rem 0;
	}
	td:first-child {
		min-width: 4rem;
	}
</style>
<p>
The Pumping System Assessment Tool was developed by the Department of Energy's BestPractices Program to assist in preliminary assessments of how efficiently pumping systems are operating.
</p> 
<strong>Information</strong>
<ul>    
	<li><a onclick='lnk(event,"about")' href=''>About</a></li>
    <li><a onclick='lnk(event,"help")' href=''>Help</a></li>
	<li><a onclick='lnk(event,"goal")' href=''>Ultimate Goal</a></li>
    <li><a onclick='lnk(event,"mvr")' href=''>Measured vs Required</a></li>
	<li style='margin-bottom:1rem'><a onclick='lnk(event,"losses")' href=''>System Losses</a></li>	
</ul>
<strong>Analysis</strong>
<ul>    
	<a onclick='lnk(event,"units")' href=''>Units</a><br>
	<a onclick='lnk(event,"conditions")' href=''>Pump Conditions</a><br>
	<a onclick='lnk(event,"pump_eff")' href=''>Pump Efficiency</a><br>
	<a onclick='lnk(event,"motor_perf")' href=''>Motor Performance</a><br>
	<a onclick='lnk(event,"specific_speed")' href=''>Specific Speed</a><br>
	<a onclick='lnk(event,"nema")' href=''>NEMA</a><br>	
</ul>
<table>
	<tr>
		<td><button onclick='reset()'>RESET</button></td><td>Reset all analysis data to defaults</td>
	</tr>
	<tr>
		<td><button onclick='imprt()'>IMPORT</button></td><td>Load analysis data from file</td>
	</tr>
	<tr>
		<td><button onclick='xprt()'>EXPORT</button></td><td>Save analysis data to file</td>
	</tr>
</table>
<script>
	function lnk(e,nm) {
		e.preventDefault();
		go(nm);
	}
	function reset() {
		loadData(true);
		loadPg();
		alert("Reset complete.");
	}	
	function imprt() {
		Dlg.showOpenDialog(DlgFilter,
			function (fn) {
				if (fn ) {
					const 
						fs = require('fs'),
						lines=fs.readFileSync(fn[0],'utf8').split('\n'),
						hd=lines[1].split('\t').filter(e => e > 'Z' );
					Conds=[];
					[,DefCond,Units,HeadTool,Curve,MotorPerf]=JSON.parse(lines[0]);					
					lines.slice(2).forEach((ln,row)=>{
						Conds.push({});
						ln.split('\t').slice(0,hd.length).forEach((v,i)=>{
							Conds[row][hd[i]]=JSON.parse(v);
						});
					});
					save();
					loadPg();	
				}
			}
		); 
	}		
	function xprt() {		
		Dlg.showSaveDialog(DlgFilter,
			function (fn) {
				if (fn) {					
					let hd, lines;
					Conds.forEach(function(c,i) {
						const r = crunch(cvtArg(c));						
						if (i==0) {
							hd = Object.keys(Conds[0]).sort().concat(Object.keys(r).sort());
							lines=[JSON.stringify([0,DefCond,Units,HeadTool,Curve,MotorPerf]),hd.join('\t')];
						}
						let o = $.extend(crunch(cvtArg(c)),c);
						lines.push(
							hd.map((nm,i)=> {
								return JSON.stringify(o[nm]);
							}).join('\t')
						);
					});		
					require('fs').writeFile(fn,lines.join('\n'));				
				}
		}); 
	}

	DlgFilter={filters: [{ name: 'Tab Separated Values', extensions: ['tsv'] }]};
	
</script>