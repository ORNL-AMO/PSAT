
<style scoped=scoped>     
  em {
    font-size: .75rem;
  } 
  tbody tr:nth-child(odd) {
    background-color: lightgray;
  }
  th,.th {
    color: green;
    font-weight: bold;
    text-align: center;

  }
  td:nth-child(2),th:nth-child(2) {
    display: none;
  }
  td.result {
    position: relative;
  }
  td.result span {
    position: absolute; 
    left: 50%;
    bottom: 1px;
    color: green;
  }
  .sum {
    font-weight: bold;
  }
  .sum td:not(:first-child) {
    color: green;
  }      
  td input[type=number] {
    width:7rem;
  }
  td select {
    width:100%;
    padding-left: 5px;
    padding-right: 5px;
    display: block;
  }
  .vam span, .vam button {
    vertical-align: middle;
  }
  
</style>
Units
<select>
  <option>gpm, ft, hp</option>
  <option>MGD, ft, hp</option>
  <option>L/s, m, kW</option>
  <option>m<sup>3</sup>/hr, m, kW</option>
</select>   
Pump Style
<select>
  <option>End suction slurry</option>
  <option>End suction sewage</option>
  <option>End suction stock</option>
  <option>API double suction</option>
  <option>Multistage boiler feed</option>
  <option>End suction ANSI/API</option>
  <option>Axial flow</option>
  <option>Double suction</option>
  <option>Vertical turbine</option>
  <option>Large end suction</option>
  <option>Specified optimal eff</option>
</select><br>
<hr>          
<table>
  <thead>
    <tr>
      <!-- <th>Pump</th><th><button onclick='loadNotes(this)'>1</button></th><th class='hover' onclick='load("conditions")'><button>ADD CONDITION</button></th>
       -->
      <th>Pump</th>
        <th>
          <button onclick='rm(this)'><i class="fa fa-times"/></button>
          <span>1</span>
          <button onclick='save(this);'><i class="fa fa-floppy-o"/></button><button onclick='loadNotes(this)'><i class="fa fa-pencil-square-o"></button></i>
        </th>
        <th class='hover' onclick='load("conditions")'><button><i class="fa fa-plus-square"/></button></th>
      
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Pump <em>(rpm)</em></td><td><input name='pump_rpm' type="number"></td>
    </tr>
    <tr>
      <td>Drive</td>
      <td> 
        <select name='drive'>
          <option>Direct drive</option>
          <option>Belt drive</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Kinematic Viscosity <em>(cS)</em></td>
      <td><input name='viscosity' type="number"></td>
    </tr>
    <tr>
      <td>Specific Gravity</td>
      <td><input name='specific_gravity' type="number"></td>
    </tr>
    <tr>
      <td>Number Stages</td>
      <td><input name='stages' type="number"></td>
    </tr>
    <tr>
      <td>Fixed specific speed?</td>
      <td><input name='speed' type="checkbox"></td>
    </tr>
    <tr>
      <td class='th'>Motor</td><td/>
    </tr>
      <td>Line freq <em>(Hz)</em></td>
      <td> 
        <select name='line'>
          <option>50</option>
          <option>60</option>
        </select>
      </td>
    </tr>      
    <tr>
      <td>Power Rating</td>
      <td><input name='power_rating' type="number"></td>
    </tr>
    <tr>
      <td>Motor rpm</td>
      <td><input name='motor_rpm' type="number"></td>
    </tr>
    <tr>
      <td>Efficiency class</td>
      <td> 
        <select>
          <option>Standard</option>
          <option>Energy</option>
          <option>Average</option>
          <option>Specified?</option>
        </select>
      </td>
    </tr>    
    <tr>
      <td>Voltage</td>
      <td><input name='motor_voltage' type="number"></td>
    </tr>
    <tr>
      <td>Full-load amps</td>
      <td><input name='amps' type="number"><button>EST</button></td>
    </tr>
    <tr>
      <td>Size margin</td>
      <td><input name='margin' type="number"></td>
    </tr>
    <tr>
      <td class='th'>Cost</td><td/>
    </tr>
    <tr>
      <td>Operating fraction</td>
      <td><input name='fraction' type="number"></td>
    </tr>
   <tr>
      <td>$ / kwhr</td>
      <td><input name='cost' type="number"></td>
    </tr>
    <tr>
      <td class='th'>Field</td><td/>
    </tr>        
    <tr>
      <td>Flow rate</td>
      <td><input name='flow' type="number" onchange="pumpEff(this)"></td>
    </tr>
    <tr>
      <td>Head</td>
      <td><input name='head' type="number"><button onclick='load("headtool")'><i class="fa fa-wrench"/></button></td>
    </tr>       
    <tr>
      <td>Load estimate method</td>
      <td> 
        <select>
          <option>Power</option>
          <option>Curent</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Estimated Power</td>
      <td><input name='est_power' type="number"></td>
    </tr>
    <tr>
      <td>Voltage</td>
      <td><input name='field_voltage' type="number"></td>
    </tr>
    <tr>
      <td class='th vam'><span>Results</span> <button onclick='load("curve")'><i class="fa fa-line-chart"/></button></td><td></td>
    </tr>
    <tr>
      <td>Pump efficiency</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor rated power</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor shaft power</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Pump shaft power</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor efficiency</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor power factor</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor current</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Motor power</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Annual energy</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Annual cost</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td class=th>Summary</td><td></td>
    </tr>
    <tr class=sum>
      <td>Savings potential</td>
      <td class='result'><span></span></td>
    </tr>
    <tr class=sum>
      <td>Optimization rating</td>
      <td class='result'><span></span></td>
    </tr>
  </tbody>
</table>

<script>
  function rm(e) {
    $(`td:nth-child(${$(e).parent().index()+1})`).remove();    
    $(e).parent().remove();
  }
  function save(e) {
    $('td:nth-child('+($(e).parent().index()+1)+') [name]').each(function(i,el) {
      let v;
      if ($(el).is(':checkbox')) {
        v = el.checked;
      } else if ($(el).is('input')) {
        v = $(el).val();
      } else if ($(el).is('select')) {
        v = $(el).children(':selected').index();
      }     
      Cond[$(e).parent().data('idx')][$(el).attr('name')] = v;
    });
    LS.setItem('conditions',JSON.stringify(Cond));
  }
  function load(nm) {
    Main = $('body').contents().detach();    
    $('body').load(nm+'.html');
  }
  function loadNotes(e) {
    Idx = $(e).parent().data('idx');
    load('notes');
  }
  function pumpEff(v) {   
    let i = $(v).parent().index();
    let r = $('td:contains("Pump efficiency")').parent();
    r.children().eq(i).html(Bridge.pumpEff($(v).val()));
  }
  function setPump() {
    let th = $('th').filter(function(i,e) {
      return Idx == $(e).data('idx');
    });
    if (th.length == 0) {
      addPump(Cond[Idx]);
    } else {
      $(th).find('span').text(Cond[Idx].name);      
    }
  }
  function addPump(d) {     
    const thAdd = $('th').last().detach();
    $('table tr').each(function (i,e) {
      const newEl = $($(e).children()[1]).clone();
      $(e).append(newEl);
      if (i==0) {
        newEl.find('span').text(d.name);     
        newEl.data('idx',Idx);
        newEl.after(thAdd);    
      } else {
        const inp = newEl.find('[name]');
        const v = d[inp.attr('name')];
        if (inp.is(':checkbox')) {
          inp[0].checked = v;
        } else if (inp.is('input')) {
          inp.val(v);
        } else if (inp.is('select')) {
          newEl.find('option')[v].selected = true;
        }
      }
    });   
    pumpEff($('[name=flow]').last());
  }  
</script>
