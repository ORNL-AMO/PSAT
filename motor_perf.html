
<style>
	em {
		color: #5d9300;
	}
	label {
		font-size: .75rem;
		font-style: italic;
    }
	canvas {
		background-color: black;
		display:none;		
	}
	button {
		margin-top: .5rem;
	}
	.vsp {
		margin-bottom: .5rem;
		display:block;
	}
}
</style>
<h1>Motor Performance</h1>
<div style='display:flex; justify-content: space-between;'>
	<div style='white-space: nowrap'>
		Line Frequency <em>(Hz)</em>
		<label><input name=line type=radio value=0> 50</label>
		<label class=vsp><input name=line type=radio value=1> 60</label>
		Motor Power <em id=unit_pow></em><br>
		<input name=motor_rated_power class=vsp>
		<!--Motor Power Units
		<label><input name=unit type=radio> hp</label>
		<label class=vsp><input name=unit type=radio> kW</label>-->
		Speed <em>(rpm)</em><br>
		<input name=motor_rated_speed class=vsp>
		Efficiency Class<br>
		<label><input name='efficiency_class' type=radio value=0> Standard</label>
		<label><input name='efficiency_class' type=radio value=1> Energy</label>
		<label class=vsp><input name='efficiency_class' type=radio value=2> Custom </label>
		<input class=vsp name='efficiency'></input>
		Voltage <em>(V)</em><br>
		<input name=motor_rated_voltage class=vsp>
		Full-load Current <em>(A)</em><br>
		<div class=vsp><input name='flc'> <button onclick='estFLC(this)'>EST</button></div>
		<button id=plot-btn onclick='plot()'>PLOT</button>
	</div>
	<canvas width="700" height="500"></canvas>
</div>

<script>//# sourceURL=*pump_eff
	function plot() {
		const 	
				[xMax, xStep, xCnt] = [120,10,12],
				[yMax, yStep, yCnt] = [130,10,13],				
				ctx = Cnv.getContext('2d'),
				PADx = 25, PADy = 50;

		$('#plot-btn').hide();
		$(Cnv).show();

		ctx.strokeStyle = "#5d9300";
		ctx.fillStyle = "white";
		ctx.textAlign = 'center';
		ctx.textBaseline = 'middle';
		ctx.font = '12px san serif';
		
		function xPos(x) {
			return x*(Cnv.width-PADx*2)/(xStep*xCnt)+PADx;
		}
		function yPos(y) {
			return (yStep*yCnt-y)*(Cnv.height-PADy*2)/(yStep*yCnt)+PADy;
		}
		ctx.beginPath();
		ctx.textBaseline = 'top';
		for (let i=0; i<=xCnt; i++) {
			const x = i*xStep, xp = xPos(x);
			ctx.moveTo(xp,PADy);
			ctx.lineTo(xp,Cnv.height-PADy);	
			ctx.fillText(x,xp,Cnv.height-PADy+5);	
		}
		ctx.textAlign = 'right';
		ctx.textBaseline = 'middle';
		for (let j=0; j<=yCnt; j++) {
			const y = j*yStep, yp = yPos(y);
			ctx.moveTo(PADx,yp);
			ctx.lineTo(Cnv.width-PADx,yp);	
			ctx.fillText(y,PADx-5,yp);	
		}
		ctx.stroke();
		ctx.save();

		ctx.fillStyle = '#FECB00';
		ctx.font = '14px san serif';
		ctx.textAlign = 'center';
		ctx.fillText('Motor Shaft Load (%)',Cnv.width/2,Cnv.height-.33*PADy);
		
		ctx.textAlign='right';
		ctx.textBaseline='top';
		
		ctx.fillStyle = 'white';
		ctx.fillText("Current (% FLC)",Cnv.width-PADx,0);
		ctx.fillStyle = '#FECB00';
		ctx.fillText("Efficiency (%)",Cnv.width-PADx,16);
		ctx.fillStyle = '#1F82BB';
		ctx.fillText("Power Factor (%)",Cnv.width-PADx,32);
		
		/*
		ctx.translate(.33*PAD,Cnv.height/2);
		ctx.rotate(-Math.PI/2);
		ctx.fillStyle = 'white';
		let tw = ctx.measureText('Current; ').width;
		ctx.fillText('Current',0,0);
		ctx.fillStyle = '#FECB00';
		let tw2 = ctx.measureText('Efficiency; ').width;
		ctx.fillText('Efficiency; ',tw,0);
		ctx.fillStyle = '#1F82BB'
		ctx.fillText('PF',tw+tw2,0);
		//ctx.fillText('Current; Efficiency; PF (%)',0,0);	
		*/

		ctx.restore();
		ctx.lineWidth = 2;		

		let m = new Map();		
		for (let x=0; rnd(x)<=120; x+=12/10) {		
			m.set(x,Bridge.motorPerformance(setData({
				load_factor: x/100
			})));	
		}
		ctx.strokeStyle = "#FECB00";	
		ctx.beginPath();
		for (let [x,y] of m.entries()) {
			ctx.lineTo(xPos(x), yPos(y.efficiency));
		}
		ctx.stroke();

		ctx.strokeStyle = "white";	
		ctx.beginPath();
		for (let [x,y] of m.entries()) {
			ctx.lineTo(xPos(x), yPos(y.current));
		}
		ctx.stroke();

		ctx.strokeStyle = "#1F82BB";	
		ctx.beginPath();
		for (let [x,y] of m.entries()) {
			ctx.lineTo(xPos(x), yPos(y.pf));
		}
		ctx.stroke();

	}
	
/////
	Cnv = dom('canvas');
	
	function estFLC(e) {
		nm('flc').val(flc(cvtArg(MotorPerf)));
	}
	function effChg() {
		if (nm('efficiency_class').filter(':checked').parent().text().trim()=='Custom') {
			nm('efficiency').show();      
		} else {
			nm('efficiency').hide();
		}
	}

	pg('#unit_pow').text(`(${unit(POWER)})`)
	setCtls(MotorPerf);
	nm('efficiency_class').change(effChg);	
	nmAll().change(()=>{
		$(Cnv).hide();
		Cnv.width+=0;
		$('#plot-btn').show();
		setData(MotorPerf);
		saveProp('motorPerf',MotorPerf);
	});
	effChg();
	
	
</script>

