<!DOCTYPE html>
<html>
  <head>
  <title>Pumping System Assessment Tool</title>
  <link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.min.css">
    <style>
      em, dialog label {
        font-size: .75rem;
        font-style: italic;
      }
      label {
        display: block;
      }
      label > * {
        vertical-align: middle;
      }
      label [type=radio] {
        margin-top: 0;
        margin-bottom: 3px;
      }
      input:not([type=radio]) {
        padding: .5em;
        border: solid 1px #fff;
        box-shadow: inset 1px 1px 2px 0 #707070;
      }
      [type=radio]:hover,[type=checkbox]:hover {
        cursor: pointer;
      }

      .prime {
        color: white;
        background-color: dodgerblue;
      }     
      button {
        color: dodgerblue;
        background-color: white;
        border: 1px solid lightgray;
        border-radius: 4px;
        padding: 3px 6px;
      }
      button:hover {
        border-color: dodgerblue;
        cursor: pointer;
      }

      h1 {
        color: green;
      }

      th,.th {
        color: green;
        font-weight: bold;
        text-align: center;
        white-space: nowrap;
      }
      td > * {
        vertical-align: middle;
      }

      #back {
        position: absolute;
        top: 1rem;
        left: 1rem;
        display: none;
      }
      html {
        font-family: sans-serif;
        font-size: 14pt;
      }
      body {
        padding:2.5% 5%;
        background-color: ghostwhite;
      }
    </style>
  </head>
  <body> 
    <button id=back onclick='back()'><i class="fa fa-long-arrow-left fa-lg"></i></button>
    <div id=container></div>
    <script>
      function dom(e) {
        return $(e)[0];
      }
      function rnd(v) {
        return Math.round(v*10000)/10000;
      }
      function setCtls(ctls,d) {
        ctls.each((j,e)=>{
          const ctl = $(e), v = d[ctl.attr('name')];
          switch (e.type) {
            case 'text':case 'number':
              ctl.val(rnd(v));
              break;
            case 'checkbox':
              e.checked = v;
              break;
            case 'select-one':
              ctl.find('option')[v].selected = true;
          }
          ctl.trigger('change');
        });
      }
      CVT_FLOW = {MGD:694.4422834,'m^3/hr':4.402867544,'L/s':15.85032316, 
        'm^3/s':15850.32316, 'ft^3/s':448.8311693};

      function cvt(v,i,nu,m) {
        if (m[Units[i]]) {
          v *= m[Units[i]];
        }
        if (m[nu]) {
          v /= m[nu];
        }
        return v;
      }
      function parIdx(e,a=0) {
        return $(e).parent().index()+a;
      }
      function saveCond() {
        saveProp('conditions',Cond);
      }  
      function loadProp(nm) {
        return JSON.parse(LS.getItem(nm));
      }
      function saveProp(nm,v) {
        LS.setItem(nm,JSON.stringify(v));
      }
      IMP = ['gpm','hp','ft','psig'];      
      function loadData(reset) {
        if (reset) {
          saveProp('defCond', {
            pump_style: 5,
            pump_rpm: 1780,
            drive: 0,
            viscosity: 1,
            specific_gravity: 1,
            stages: 1,
            speed: false,
            line: 1,
            power_rating: 30,
            motor_rpm: 1780,
            efficiency_class: 0,
            efficiency:0,
            motor_voltage: 460,
            amps: 225.4,
            margin: 0,
            fraction: 1,
            cost: .05,
            flow: 2000,
            head: 277,
            load_method: 0,
            est_power: 150,
            field_voltage: 460,

            grid: false       
          });        
          saveProp('units',IMP);
          saveProp('conditions',[]);          
        }
        Cond = loadProp('conditions');
        Units = loadProp('units');
        return (DefCond= loadProp('defCond'));
      }
      function load(nm,bkHide) {
        back = main;
        $('#container').load(nm+'.html',function () {
          if (bkHide) {
            $('#back').hide();
          } else {
            $('#back').show();
          }
        });
      }
      function main() {
        load('conditions',true);
      }      

      Dlg=require('electron').remote.dialog;
      Bridge = require('./build/Release/bridge');
      LS = localStorage;
      $ = require('jquery');

      if (!loadData()) {
        loadData(true);
      }
      $(document).ready(function() {
        main();
      });
    </script>
  </body>
</html>
