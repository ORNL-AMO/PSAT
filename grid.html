
<style scoped=scoped>       
  tbody tr:nth-child(odd) {
    background-color: lightgray;
  }
  th,.th {
    color: green;
    font-weight: bold;
    text-align: center;

  }
  td > * {
    vertical-align: middle;
  }
  td:nth-child(2),th:nth-child(2) {
    display: none;
  }
  td.result {
    position: relative;
  }
  td.result span {
    position: absolute; 
    left: 50%;
    bottom: 1px;
    color: green;
  }
  .sum {
    font-weight: bold;
  }
  .sum td:not(:first-child) {
    color: green;
  }      
  td input[type=number] {
    width:7rem;
  }
  td select {
    width:100%;
    padding-left: 5px;
    padding-right: 5px;
    display: block;
  }
  .vam span, .vam button {
    vertical-align: middle;
  }
  dialog label {
    display: block;
  }
  td>div {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  td>div>em {
    color: green;
  }
</style>
<table>
  <thead>
    <tr>      
      <th onclick=backload('mock')>Pump</th>
        <th>
          <button onclick='rm(this)'><i class="fa fa-times"/></button>
          <span></span>
          <button onclick='showIO(this);'><i class="fa fa-floppy-o"></i></button><button onclick='edit(this)'><i class="fa fa-pencil-square-o"></i></button>
        </th>      
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span>Style</span></td>
      <td>
        <select name='pump_style'>
          <option>End suction slurry</option>
          <option>End suction sewage</option>
          <option>End suction stock</option>
          <option>API double suction</option>
          <option>Multistage boiler feed</option>
          <option>End suction ANSI/API</option>
          <option>Axial flow</option>
          <option>Double suction</option>
          <option>Vertical turbine</option>
          <option>Large end suction</option>
          <option>Specified optimal eff</option>
        </select>
      </td>
    </tr>  
    <tr>
      <td><div>Speed <em>(rpm)</em></div></td><td><input name='pump_rpm' type="number"></td>
    </tr>
    <tr>
      <td>Drive</td>
      <td> 
        <select name='drive'>
          <option>Direct drive</option>
          <option>Belt drive</option>
        </select>
      </td>
    </tr>
    <tr>
      <td><div>Kinematic Viscosity <em>(cS)</em></div></td>
      <td><input name='viscosity' type="number"></td>
    </tr>
    <tr>
      <td>Specific Gravity</td>
      <td><input name='specific_gravity' type="number"></td>
    </tr>
    <tr>
      <td>Number Stages</td>
      <td><input name='stages' type="number"></td>
    </tr>
    <tr>
      <td>Fixed specific speed?</td>
      <td><input name='speed' type="checkbox"></td>
    </tr>
    <tr>
      <td class='th'>Motor</td><td/>
    </tr>
      <td><div>Line freq <em>(Hz)</em></div></td>
      <td> 
        <select name='line'>
          <option>50</option>
          <option>60</option>
        </select>
      </td>
    </tr>      
    <tr>
      <td><div>Power Rating</div></td>
      <td>
        <input name='power_rating' type="number">
      </td>
    </tr>
    <tr>
      <td><div>Speed <em>(rpm)</em></div></td>
      <td><input name='motor_rpm' type="number"></td>
    </tr>
    <tr>
      <td>Efficiency class</td>
      <td> 
        <select name='efficiency'>
          <option>Standard</option>
          <option>Energy</option>
          <option>Average</option>
          <option>Specified?</option>
        </select>
      </td>
    </tr>    
    <tr>
      <td>Voltage</td>
      <td><input name='motor_voltage' type="number"></td>
    </tr>
    <tr>
      <td>Full-load amps</td>
      <td><input name='amps' type="number"> <button>EST</button></td>
    </tr>
    <tr>
      <td><div>Size margin <em>(%)</em></div></td>
      <td><input name='margin' type="number"></td>
    </tr>
    <tr>
      <td class='th'>Cost</td><td/>
    </tr>
    <tr>
      <td>Operating fraction</td>
      <td><input name='fraction' type="number"></td>
    </tr>
   <tr>
      <td>$ / kwhr</td>
      <td><input name='cost' type="number"></td>
    </tr>
    <tr>
      <td class='th'>Field</td><td/>
    </tr>        
    <tr>
      <td><div>Flow rate</td>
      <td><input name='flow' type="number" onchange="pumpEff(this)"></td>
    </tr>
    <tr>
      <td><div>Head</div></td>
      <td>
        <input name='head' type="number">
        <button onclick='gotoHead(this)'><i class="fa fa-wrench"/></button>
      </td>
    </tr>       
    <tr>
      <td>Load estimate method</td>
      <td> 
        <select name='load_method'>
          <option>Power</option>
          <option>Current</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Estimated Power</td>
      <td><input name='est_power' type="number"></td>
    </tr>
    <tr>
      <td>Voltage</td>
      <td><input name='field_voltage' type="number"></td>
    </tr>
    <tr>
      <td class='th vam'><span>Results</span> <button onclick='backload("curve")'><i class="fa fa-line-chart"/></button></td><td></td>
    </tr>
    <tr>
      <td><div>Pump efficiency <em>(%)</em></div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor rated power</div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor shaft power</div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Pump shaft power</div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor efficiency <em>(%)</em></div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor power factor <em>(%)</em></div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor current <em>(amps)</em></div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Motor power</div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td><div>Annual energy <em>(MWh)</em></div></td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td>Annual cost</td><td class='result'><span></span></td>
    </tr>
    <tr>
      <td class=th>Summary</td><td></td>
    </tr>
    <tr class=sum>
      <td>Savings potential</td>
      <td class='result'><span></span></td>
    </tr>
    <tr class=sum>
      <td>Optimization rating</td>
      <td class='result'><span></span></td>
    </tr>
  </tbody>
</table>
<dialog id='io'>
  <label>
    <input name=saveopt type="radio" checked> Save
  </label>  
  <label>
    <input name=saveopt type="radio"> Save as Default
  </label>
  <label>
    <input name=saveopt type="radio"> Load from Default
  </label>
  <button onclick='io($(this.parentElement))'>ACCEPT</button> 
  <button onclick='this.parentElement.close()'>CANCEL</button>
</dialog>
<dialog id='units'>
  Choose units<br>
  <label>
    <input name=units value=.0630901966667 type="radio" checked> L/s, m, kW
  </label>
  <label>
    <input name=units value=43.8126364 type="radio"> m^3/hr, m, kW
  </label>
  <label>
    <input name=units value=0.277778 type="radio"> gpm, ft, hp
  </label>
  <label>
    <input name=units value=0.277778 type="radio"> MGD, ft, hp
  </label>
  <button onclick='cvtUnits($(this).parent())'>CONVERT</button>
  <button onclick='this.parentElement.close()'>CANCEL</button>
</dialog>

<script>
  function cvtUnits() {
    loadProp('units');
    saveProp('units',$('#units :checked').parent().index()-1);
    $('[name=power_rating]:gt(0)').each(function (i,e) {
      $(e).val(3);
    });
    $('#units')[0].close();
  }
  function showUnits() {
    alert(loadProp('units'));
    $('#units :input').get(loadProp('units')).checked=true;
    $('#units')[0].showModal();
  }
  function showUnit_kW(e) {
    showUnitSgl(e,'horsepower <em>(hp)</em>',.745699872);
  }
  function rm(e) {
    Cond[$(e).parent().data('idx')].grid = false;
    col(e).remove();
    $(e).parent().remove();
  }
  function showIO(e) {
    $('#io')[0].showModal();
    $('#io').data('src',$(e));
  }
  function col(e) {
    return $(`td:nth-child(${$(e).parent().index()+1})`);
  }
  function colFlds(e,t) {
    return col(e).find(`[name${t ? ('='+t) : ''}]`);
  }
  function colData(e) {
    let v,d={};
    colFlds(e).each(function(i,el) {
      if ($(el).is(':checkbox')) {
        v = el.checked;
      } else if ($(el).is('input')) {
        v = $(el).val();
      } else if ($(el).is('select')) {
        v = $(el).children(':selected').index();
      }     
      d[$(el).attr('name')] = v;
    }); 
    return d;   
  }
  function io(dlg) {
    let e = dlg.data('src');
    switch(dlg.find(':checked').parent().index()) {
        case 1:
          saveProp('defaults',colData(e));
          break;
        case 2:
          let v,d = loadProp('defaultCondition');
          colFlds(e).each(function(i,el) {
            v = d[$(el).attr('name')];
            if ($(el).is(':checkbox')) {
              el.checked = v;
            } else if ($(el).is('input')) {
              $(el).val(rnd(v));
            } else if ($(el).is('select')) {
              $(el).find('option')[v].selected = true;
            }     
          });
          break;
        default:
          $.extend(Cond[$(e).parent().data('idx')],colData(e));
          saveCond();
    }
    dlg[0].close(); 
  }
  function backload(nm) {
    Grid = $('#container').contents().detach();
    load(nm);
    back = backToGrid;
  }
  function backToGrid() {
    $('#container').html(Grid);
    //$('#container').append($('#container script').remove());

    $('th:gt(1)').each(function(i,e) {
      $(e).find('span').text(Cond[$(e).data('idx')].name);
    });
    delete Grid;
    back = main;
  }
  function gotoHead(e) {
    Flow = colFlds(e,'flow').val();
    SG = colFlds(e,'specific_gravity',e).val();
    HeadEl = colFlds(e,'head');
    backload("headtool");
  }
  function edit(e) {
    Idx = $(e).parent().data('idx');
    backload('notes');
  }
  function pumpEff(v) {   
    let i = $(v).parent().index();
    let r = $('td:contains("Pump efficiency")').parent();
    r.children().eq(i).html(Bridge.pumpEff($(v).val()));
  }
  function fldUnit(nm,txt) {
    $(`td>div:contains(${nm})`).last().append(`<em>(${txt})</em>`);;
  }

  units = loadProp('units');
  txt = units <= 1 ? 'kW' : 'hp';
  fldUnit('Power Rating', txt);
  fldUnit('Motor rated', txt);
  fldUnit('Motor shaft', txt);
  fldUnit('Pump shaft', txt);
  fldUnit('Motor power', txt);

  fldUnit('Head', units <= 1 ? 'm' : 'ft');
  fldUnit('Flow', ['L/s', 'm^3/hr', 'gpm', 'MGD'][units]);

</script>
