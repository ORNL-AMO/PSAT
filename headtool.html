<style scoped=scoped>
	em {
		font-size: smaller;
		font-weight: lighter;
	}
	strong {
		font-size: smaller;
		font-weight: bold;
	}
	table {
		border-collapse: collapse;
	}
	table input {
		margin-bottom: .75rem;
	}
	th {
		text-align: left;
	}
	#results {
		/*vertical-align: bottom;*/
	}
	#results td:first-child {
		padding-right: 1rem;
	}
	#results~ tr:nth-child(n+2) {
		background-color: #C3C8C8;
	}
	#result {
		color: #5d9300;
		font-weight: bold;
	}
}
</style>
<h1>Head Tool</h1>
<img src='headtool_a.png' width=600>
			<table>
				<tr>
					<th>Suction</th>
					<th>Discharge</th>
				</tr>
				<tr>
					<td>
						Suction pipe inner diameter<br>
						<input name=Ds><br>
					</td>
					<td>
						Discharge pipe inner diameter<br>
						<input name=Dd><br>
					</td>
				</tr>
				<tr>
					<td>
						<label>Suction tank<br>
							<input name=suc onchange='suction(this)' type=checkbox>
						</label>
					</td>
					<td></td>
				</tr>
				<tr>
					<td class=sucGauge>
						Suction gauge pressure <strong>(Ps)</strong><br>
						<input name=Ps><br>
					</td>
					<td>
						Discharge gauge pressure <strong>(Pd)</strong><br>
						<input name=Pd><br>

					</td>
				</tr>
				<tr>
					<td class=sucGauge>
						Suction gauge elevation <strong>(Zs)</strong><br>
						<input name=Zs><br>
					</td>
					<td>
						Discharge gauge elevation <strong>(Zd)</strong><br>
						<input name=Zd><br>

					</td>
				</tr>
				<tr>
					<td>
						Suction line loss coefficients <strong>(Ks)</strong><br>
						<input name=Ks><br>
					</td>
					<td>
						Discharge line loss coefficients <strong>(Kd)</strong><br>
						<input name=Kd><br>

					</td>
				</tr>
			
			<!--<div id="sucTank" style="display: none">
				Suction tank gas overpressure<br>
				<input name=Pg_s><br>
				Suction tank fluid surface elevation<br>
				<input name=Ztnk_s><br>
			</div>-->
			
				<tr id=results>
					<td>Flow: <span id="flow" style=""/></td>
					<td>Specific Gravity: <span id="sg"></span></td>
				</tr>
				</tr>
				<tr>
					<th>Head</th>
					<th>Result</th>
				</tr>
				<tr>
					<td>Differential elevation head</td>
					<td></td>
				</tr>
				<tr>
					<td>Differential pressure head</td>
					<td></td>
				</tr>
				<tr>
					<td>Differential velocity head</td>
					<td></td>
				</tr>
				<tr>
					<td>Estimated suction friction head</td>
					<td></td>
				</tr>
				<tr>
					<td>Estimated discharge friction head</td>
					<td></td>
				</tr>
				<tr>
					<td>Pump head</td>
					<td id=result></td>
				</tr>				
			</table>
			
		
	</tr>
	
		
			<button class=prime onclick='calc()'>CALCULATE</button>
			<button class=prime id=accept onclick='accept()' style="display: none">ACCEPT</button>
		
		
	

			

<script>
	function suction(e) {
		if (e.checked) {
			$('#sucGauge').hide();
			$('#sucTank').show();
		} else {
			$('#sucGauge').show();
			$('#sucTank').hide();
		}
	}
	function v(d,flow) {
		return flow / (Math.PI*(d/2)*(d/2));
	}
	function vHd(v,g) {
		return v*v/2/g;
	}
	function r(txt,v) {
		$(`#results~ tr>td:contains(${txt})`).next().text(rnd(v));
	}
	function calc() {
        let flowU, distF, g;
        if (unit(DIST)=='ft') {
			flowU='ft^3/s';
			g=32.1740;
			distF=12;
        } else {
			flowU='m^3/s';
			g=9.8065;
			distF = 1000;
        }
		let 
			flow = cvt(Cond.flow,FLOW,flowU),
			sucTnk = dom(nm('suc')).checked,
			elevHd = nm('Zd').val()-(sucTnk ? nm('Ztnk_s') : nm('Zs')).val(),
			presHd = cvt(nm('Pd').val()-(sucTnk ? nm('Pg_s') : nm('Ps')).val(),
				PRESSURE,unit(DIST))/Cond.specific_gravity,
			vHdS = vHd(v(nm('Ds').val()/distF,flow),g),
			vHdD = vHd(v(nm('Dd').val()/distF,flow),g),
			vHdDif = vHdD - (sucTnk ? 0 : vHdS),
			sucHd = nm('Ks').val()*vHdS,
			disHd = nm('Kd').val()*vHdD;
		Head = elevHd + presHd + vHdDif + sucHd + disHd;
		r('elevation',elevHd);
		r('pressure',presHd);
		r('velocity',vHdDif);
		r('suction',sucHd);
		r('discharge',disHd);
		r('Pump',Head);
		$('#accept').show();

		setData(HeadTool);
		saveHd();
	}
	function em(t) {
		return ` <em>(${t})</em>`;
	}
	function hdFldUnit(s) {
		nm(`${s}s`).after(` <em>${_txt}</em>`);
		nm(`${s}d`).after(` <em>${_txt}</em>`);
	}
	function accept() {
		Cond.head = Head;
		saveConds();
		back();
	}
	_txt = unit(DIST) == 'ft' ? 'inches' : 'mm';
	hdFldUnit('D');
	_txt = unit(DIST);
	hdFldUnit('Z');
	hdFldUnit('Ztnk_');
	$('#results th').last().append(em(_txt));
	_txt = unit(PRESSURE);
	hdFldUnit('P');
	hdFldUnit('Pg_');
	$('#flow').html(Cond.flow+em(unit(FLOW)));
	$('#sg').text(Cond.specific_gravity);
	$('input').change(function () {
		$('#results td:nth-child(2):gt(0)').text('');
		$('#accept').hide();
	});
	setCtls(HeadTool);
</script>
