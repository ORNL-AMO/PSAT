
<style>
	canvas {
		background-color: black;
	}
}
</style>
<div>
	<h1>Pump Efficiency</h1>
	<canvas width="700" height="500"></canvas>
	
</div>

<script>//# sourceURL=*pump_eff
	function plot() {
		P = {
			cnv: Cnv,
			padX: 25,
			stepX: 250,
			cntX: 20,
			padY: 50,
			stepY: 2,
			cntY: 19,
			minY: 52
		}
		const ctx = setupPlot('Flow Rate (gpm)','Achievable Efficiency (average)');
				
		ctx.fillStyle = 'white';
		ctx.fillText('Achievable Efficiency (max)',Cnv.width-P.padX,P.padY-5-15);
		
		let m = new Map();
		function get(x) {
			let r = m.get(x);
			if (!r) {
				r = Bridge.pumpEfficiency(cvtArg(setData({
						flow: x,
						pump_style: 0,
						pump_specified: 0
				})));
				m.set(x,r);
			}
			return r;
		}
		curve(x => get(x).average);
//		curve(x => get(x).current,'white');
	}
	 
	Cnv = dom('canvas');
	plot();

	function estFLC(e) {
		nm('flc').val(flc(cvtArg(MotorPerf)));
	}
	function effChg() {
		if (nm('efficiency_class').filter(':checked').parent().text().trim()=='Custom') {
			nm('efficiency').show();      
		} else {
			nm('efficiency').hide();
		}
	}

	pg('#unit_pow').text(`(${unit(POWER)})`)
	setCtls(MotorPerf);
	nm('efficiency_class').change(effChg);	
	nmAll().change(()=>{
		$(Cnv).hide();
		Cnv.width+=0;
		$('#plot_btn').show();
		setData(MotorPerf);
		saveProp('motorPerf',MotorPerf);
	});
	effChg();
	
</script>

