<style>
	#cond td>* {
		display: block;
	}
	#cond tr:first-child {
		display: none;
	}
	#cond td:nth-child(2):hover {
		background-color: #C3C8C8;
		cursor: pointer;
	}
	p button {
		float:left;
	}
</style>
<div style='display: inline-block'>
	<h1>Pump Conditions</h1>
	<ul style='font-style:italic'>
		<li>Create and edit</li>
		<li>Click to edit description</li>
		<li>Select conditions and click <i class="fa fa-table"></i> to edit input parameters</li>		
	</ul>
	<table id=cond>
		<tr>
			<td><input type="checkbox" onclick="setGrid(this)"></td>
			<td onclick='edit(this)'></td>
			<td><button onclick='rm(this)'><i class="fa fa-trash-o"></i></button></td>
			<td><button onclick='cp(this)'><i class="fa fa-plus"></i></button></td>
		</tr>
		<tr>
			<td><input class=gt0 type="checkbox" checked onclick='chkAll(this)'></input></td>
		</tr>
	</table>
	<p>
		<button class=prime onclick='nu()'>NEW</button>
		<button class=prime id=grid onclick='grid()'><i class="fa fa-table"></i></button>
		<button style='float:right' class=gt0 onclick='removeAll()'>REMOVE ALL</button>
	</p>
</div>
<script>
	function listIdx(e) {
		return parIdx(e.parentElement,-2);
	}
	function chkAll(e) {
		chk(':checkbox',e.checked);
		$.each(Conds,function(i,d) {
			d.grid = e.checked;
		});
		saveConds();
		setGridBtn();
	}
	function setGrid(e) {
		Conds[listIdx(e)].grid = e.checked;
		saveConds();
		setGridBtn();		
	}
	function grid() {
		go('grid');		
	}
	function setGridBtn() {
		if ($('#cond :checkbox:gt(1):checked').length>0) {
			$('#grid').show();
		} else {
			$('#grid').hide();
		}
	}
	function rm(e) {
		Conds.splice(listIdx(e),1);
		saveConds();
		loadPg();
	}
	function removeAll() {
		Conds = [];
		saveConds();
		loadPg();
	}
	function cp(e) {
		let o=$.extend({},Conds[listIdx(e)]);
		o.name+=' (copy)';
		Conds.push(o);
		saveConds();
		loadPg();
	}
	function edit(e) {
		Cond = Conds[parIdx(e,-2)];
		go('notes');
	}
	function nu() {
		Cond = loadProp('defCond');
		Conds.push(Cond);
		Cond.name = 'Condition ' + Conds.length;
		const dt = new Date();
    	dt.setMinutes(dt.getMinutes()-dt.getTimezoneOffset());
		Cond.date = dt.toJSON().slice(0,10);		
		saveConds();
		go('notes');
	}	
	function start() {
		$.each(Conds,function(i,d) {		
			const nu = $('#cond tr').first().clone();
			nu.children().eq(1).text(d.name);
			chk(nu.find(':checkbox'),d.grid);
			$('#cond').append(nu);		  

		});		
		if (Conds.length==0) {
			$('#cond').html('<span style="font-style:italic">None</span>');
			$('.gt0').hide();
		}		
		setGridBtn();
	}
	start();
</script>