<style scoped>
	ul {
		padding-left: 0;
	}
	li {
		list-style-type:none;
	}
	li>span:not([onclick]) {
		opacity: .6;
	}	
	li>span[onclick]:hover {
		cursor: pointer;
		color: dodgerblue;
	}	
	li:first-child {
		display: none;
	}
	li>* {
		vertical-align: middle;
	}
	th:nth-child(n+2),td:nth-child(n+2) {
		padding-right: 2rem;
	}
	#u2 td:first-child, #u3 td:first-child, #u4 td:first-child {
		color: green;
		padding-right: 1rem;
	}
	#u3 th:not(:first-child) {
		background-color: gainsboro;
	}
	#u2,#u3,#u4 {
		display: none;
	}
</style>

<h1>Units</h1>
<table id=u1 style="text-align: left">
	<tr>
		<th>Flow</th>
		<th></th>
		<th>Distance</th>
		<th>Power</th>
		<th>Pressure</th>
	</tr>
	<tr>
		<td style="padding-right: 1rem"><label><input type="radio"> L/s</label></td>
		<td><label><input type="radio"> m^3/hr</label></td>
		<td>m</td>
		<td>kW</td>
		<td>kPa</td>
	</tr>
	<tr>
		<td><label><input type="radio"> gpm</label></td>
		<td><label><input type="radio"> MGD</label></td>
		<td>ft</td>
		<td>hp</td>
		<td>psig</td>
	</tr>
</table>

<table id=u2>
	<tr>
		<td>Flow</td>
		<td><label><input checked name=1 type="radio"> L/s</label></td>
		<td><label><input name=1 type="radio"> m^3/hr</label></td>
		<td><label><input name=1 type="radio"> gpm</label></td>
		<td><label><input name=1 type="radio"> MGD</label></td>
	</tr>
	<tr>
		<td>Power</td>
		<td><label><input checked name=2 type="radio"> kW</label></td>
		<td><label><input name=2 type="radio"> hp</label></td>
	</tr>
	<tr>
		<td>Distance</td>
		<td><label><input checked name=3 type="radio"> m</label></td>
		<td><label><input name=3 type="radio"> ft</label></td>
	</tr>
	<tr>
		<td>Pressure</td>
		<td><label><input checked name=4 type="radio"> kPa</label></td>
		<td><label><input name=4 type="radio"> psig</label></td>
	</tr>
</table>
<table id=u3>
	<tr>
		<th></th>
		<th onclick="set1()">1</th>
		<th onclick="set2()">2</th>
		<th onclick="set3()">3</th>
		<th onclick="set4()">4</th>
	</tr>
	<tr>
		<td>Flow</td>
		<td><label><input checked name=31 type="radio"> L/s</label></td>
		<td><label><input name=31 type="radio"> m^3/hr</label></td>
		<td><label><input name=31 type="radio"> gpm</label></td>
		<td><label><input name=31 type="radio"> MGD</label></td>
	</tr>
	<tr>
		<td>Power</td>
		<td><label><input checked name=32 type="radio"> kW</label></td>
		<td></td>
		<td><label><input name=32 type="radio"> hp</label></td>
	</tr>
	<tr>
		<td>Distance</td>
		<td><label><input checked name=33 type="radio"> m</label></td>
		<td></td>
		<td><label><input name=33 type="radio"> ft</label></td>
	</tr>
	<tr>
		<td>Pressure</td>
		<td><label><input checked name=34 type="radio"> kPa</label></td>
		<td></td>
		<td><label><input name=34 type="radio"> psig</label></td>
	</tr>
</table>
<div id="u4">
Measurement System<br>
<select>
	<option>1</option>
	<option>2</option>
	<option>3</option>
	<option>4</option>
	<option>Custom</option>
</select>
<table>
	<tr>
		<th></th>
		<th onclick="">1</th>
		<th onclick="">2</th>
		<th onclick="">3</th>
		<th onclick="">4</th>
		<th onclick="">Custom</th>
	</tr>
	<tr>
		<td>Flow</td>
		<td>L/s</td>
		<td>m^3/hr</td>
		<td>gpm</td>
		<td>MGD</td>
		<td>
			<select>
				<option>L/s</option>
				<option>m^3/hr</option>
				<option>gpm</option>
				<option>MGD</option>
			</select>
		</td>
	</tr>
	<tr>
		<td>Power</td>
		<td>kW</td>
		<td>kW</td>
		<td>hp</td>
		<td>hp</td>
		<td>
			<select>
				<option>kW</option>
				<option>hp</option>
			</select>
		</td>
	</tr>
	<tr>
		<td>Distance</td>
		<td>m</td>
		<td>m</td>
		<td>ft</td>
		<td>ft</td>
		<td>
			<select>
				<option>m</option>
				<option>ft</option>
			</select>
		</td>
	</tr>
	<tr>
		<td>Pressure</td>
		<td>kPa</td>
		<td>kPa</td>
		<td>psig</td>
		<td>psig</td>
		<td>
			<select>
				<option>kPa</option>
				<option>psig</option>
			</select>
		</td>
	</tr>
</table>
</div>
<p style="font-size: smaller; color: gray">
	(<span onclick="u1()">ONE</span> <span onclick="u2()">TWO</span> <span onclick="u3()">THREE</span> <span onclick="u4()">FOUR</span>)

</p>
<h1>Conditions</h1>
<ul>
    <li>        	
    	<input name='speed' type="checkbox" onclick="setGrid(this)">
    	<span onclick='edit(this)'></span>	
    	<button onclick='rm($(this))'><i class="fa fa-times"></i></button>
    </li>
</ul>
<button onclick='uncheck()'><i class="fa fa-check-square"></i></button>
<button onclick='grid()'><i class="fa fa-table"></i></button>
<button onclick='nu()'>NEW</button>
<button>IMPORT</button>
<button onclick="xport()">EXPORT</button>
<button onclick='removeAll()'>REMOVE ALL</button>
<button onclick='restoreDefaults()'>RESTORE DEFAULTS</button>

<script>
	function set1() {
		$('[name=31]')[0].checked=true;
		$('[name=32]')[0].checked=true;
		$('[name=33]')[0].checked=true;
		$('[name=34]')[0].checked=true;
	}
	function set2() {
		$('[name=31]')[1].checked=true;
		$('[name=32]')[0].checked=true;
		$('[name=33]')[0].checked=true;
		$('[name=34]')[0].checked=true;
	}
	function set3() {
		$('[name=31]')[2].checked=true;
		$('[name=32]')[1].checked=true;
		$('[name=33]')[1].checked=true;
		$('[name=34]')[1].checked=true;
	}
	function set4() {
		$('[name=31]')[3].checked=true;
		$('[name=32]')[1].checked=true;
		$('[name=33]')[1].checked=true;
		$('[name=34]')[1].checked=true;
	}

	function u1() {
		$('#u2').hide();
		$('#u1').show();
		$('#u3').hide();
		$('#u4').hide();
	}
	function u2() {
		$('#u1').hide();
		$('#u2').show();
		$('#u3').hide();
		$('#u4').hide();

	}
	function u3() {
		$('#u1').hide();
		$('#u3').show();
		$('#u2').hide();
		$('#u4').hide();
	}
	function u4() {
		$('#u1').hide();
		$('#u4').show();
		$('#u2').hide();
		$('#u3').hide();
	}

	function xport() {
		var txt='h1\th2\th3\n';
		$.each(Cond,function(i,d) {
			txt += i+'\t';
		});
		txt+='\n';
		for(var prop in Cond[0]){
			txt += prop + '\t';

		}
		const fs = require('fs');
		fs.writeFile('hello.tsv',txt);
	}
	function uncheck() {
		$(':checkbox').prop('checked',false);
		$.each(Cond,function(i,d) {
			d.grid = false;
		});
		saveCond();
	}
	function setGrid(e) {
		Cond[parIdx(e,-1)].grid = e.checked;
		saveCond();		
	}
	function grid() {
		load('grid', false, function() {
		    $.each(Cond,function(idx,d) {
		      if (d.grid) {
		            $('table tr').each(function (i,e) {
						const newEl = $(e).children().eq(1).clone();						
						$(e).append(newEl);
						if (i==0) {
							newEl.find('span').text(d.name);     
							newEl.data('idx',idx);
						} else {
							const inp = newEl.find('[name]');
							const v = d[inp.attr('name')];
							if (inp.is(':checkbox')) {
							  dom(inp).checked = v;
							} else if (inp.is('input')) {
							  inp.val(rnd(v));
							} else if (inp.is('select')) {
							  newEl.find('option')[v].selected = true;
							}
						}
					});   
				    pumpEff($('[name=flow]').last());
		      }
		    });    		  
		});		
	}
	function nu() {
		Idx = Cond.length;
		load('notes');
	}
	function removeAll() {
		LS.removeItem('conditions');
		Cond = [];
		Idx = 0;
		start();
	}
	function rm(e) {
		let i = parIdx(e,-1);
		Cond.splice(i,1);
		saveCond();
		e.parent().remove();
		Main.find('th').each(function(j,el) {
			let idx = $(el).data('idx');
			if (idx>i) {
				$(el).data('idx',--idx);
			}
		});
	}
	function edit(e) {
		Idx = parIdx(e,-1);
		load('notes');
	}
	function chgUnit() {
		const uOld = loadProp('units');
		Units = $('table :input').index(this);
		$.each(Cond,function(i,d) {
			const hp2kw = .745699872;
			if (uOld>=2 && Units<=1) {
				d.power_rating *= hp2kw;
			} else if (uOld<=1 && Units >=2) {
				d.power_rating /= hp2kw;
			}
			const cvtFlow = [1,0.277778,.0630902,43.8126364];
			d.flow *= cvtFlow[uOld];
			d.flow /= cvtFlow[Units];
			const ft2m = .3048;
			if (uOld>=2 && Units<=1) {
				d.head *= ft2m;
			} else if (uOld<=1 && Units >=2) {
				d.head /= ft2m;
			}
		});
		saveProp('units',Units);
		saveCond();
	}
	function start() {
		const radUnits = $('#u1 :input');
		radUnits.get(Units).checked=true;
		radUnits.click(chgUnit);
		radUnits.attr('name','unit');

		$.each(Cond,function(i,d) {		
			let nu = $('li').first().clone();
			nu.find('span').text(d.name);
			dom(nu.find('input')).checked = d.grid;
			$('ul').append(nu);		  
		});		
		if (Cond.length==0) {
			$('ul').html('<em>None</em>');
		}		
	}
	Units = loadProp('units');
	start();
</script>